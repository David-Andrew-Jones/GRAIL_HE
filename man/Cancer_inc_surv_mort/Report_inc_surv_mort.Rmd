---
title: "Trends in cancer incidence, mortality and survival"
output: 
 html_document:
   theme: cosmo # default, cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex, and yeti
   highlight: tango # default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, breezedark, and textmate
   
---
```{r setup, include=FALSE} 
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE) 
```


```{r}
library(ggplot2)
library(plotly)
library(tidyverse)
library(ggpubr)
library(kableExtra)

load("~/GRAIL_HE/data/data_inc_2001to2020_C0toC97_allageandbysex.rda")
load("~/GRAIL_HE/data/data_mort_2001to2020_C0toC97_allageandbysex.rda")

load("~/GRAIL_HE/data/data_inc_2001to2020_C0toC97_allandbyagesex.rda")
load("~/GRAIL_HE/data/data_mort_2001to2020_C0toC97_allandbyagesex.rda")

load("~/GRAIL_HE/data/data_inc_2001to2020_bysite_allandbysex.rda")
load("~/GRAIL_HE/data/data_mort_2001to2020_bysite_allandbysex.rda")

```

<br>

#### Data

The data presented below has been extracted from CancerDataâ€™s incidence and mortality [dashboard](https://www.cancerdata.nhs.uk/incidence_and_mortality), and survival [dashboard]().

<br>

##  Incidence

For incidence, the data spans from patients diagnosed between 2001 and 2020 and is taken from the National Cancer Registration Service Cancer Analysis System. Incidence is given by year, cancer site, sex and age plus options for geographic and deprivation stratification. Below are various tabulations o

### Age-standardised **incidence** rates from 2001 to 2020 for all cancer sites (C0 to C97) combined, stratified by sex


```{r}

temp_inc <- data_inc_2001to2020_C0toC97_allageandbysex %>%
        filter(Type_of_rate == "Age-standardised") %>%
        pivot_wider(names_from = Gender, values_from = c(Count, Rate, LCI, UCI))

ggplotly(ggplot(temp_inc, aes(x=Year)) + 
  geom_line(aes(y = Rate_Persons), color = "darkred") + 
  geom_line(aes(y = LCI_Persons), color="red", linetype="twodash") +
  geom_line(aes(y = UCI_Persons), color="red", linetype="twodash") +
  geom_line(aes(y = Rate_Male), color = "blue") + 
  geom_line(aes(y = LCI_Male), color="steelblue", linetype="twodash") +
  geom_line(aes(y = UCI_Male), color="steelblue", linetype="twodash") +
  geom_line(aes(y = Rate_Female), color = "green") + 
  geom_line(aes(y = LCI_Female), color="darkgreen", linetype="twodash") +
  geom_line(aes(y = UCI_Female), color="darkgreen", linetype="twodash") +
  theme_bw() +
  theme(strip.text = element_text(size = 12)) +
  xlab("Year") +
  ylab("ASR per 100,000") +
  theme(strip.background =element_rect(fill="white")),
  height = 800, width=800) 

```

<br>

###  Annual percentage change in **incidence** from 2001 to 2020 for all cancer sites (C0 to C97) combined

### **Females** Select age group {.tabset .tabset-dropdown}

```{r}

temp_inc <- data_inc_2001to2020_C0toC97_allandbyagesex %>% 
        group_by(Gender, Age_at_Diagnosis) %>%
        arrange(Year, .by_group = TRUE) %>%
        mutate(pct_change = (Rate/lag(Rate) - 1) * 100) %>%
        filter(Age_at_Diagnosis != "All ages") %>%
        filter(grepl(c("Female"), Gender))


names_plotageinc_list <- levels(factor(temp_inc$Age_at_Diagnosis))
        
l_temp_inc <- temp_inc %>% group_split(ICD10_descrip)

plots <- map(l_temp_inc, ~ ggplotly(ggbarplot(.x, y = "pct_change", x = "Year") +
  theme_bw() +
  theme(strip.text = element_text(size = 12)) +
  xlab("Year") +
  ylab("Annual percentage change") +
  theme(strip.background =element_rect(fill="white")) +
  theme(legend.position ="bottom") +
          facet_wrap(vars(Age_at_Diagnosis), ncol = 3),
  height = 300, width=800))

names(plots) = names_plotageinc_list


```


#### 20 to 24
```{r, echo = FALSE}
plots[[1]]
```

#### 25 to 29
```{r, echo = FALSE}
plots[[2]]
```

#### 30 to 34
```{r, echo = FALSE}
plots[[3]]
```

#### 35 to 39
```{r, echo = FALSE}
plots[[4]]
```

#### 40 to 44
```{r, echo = FALSE}
plots[[5]]
```

#### 45 to 49
```{r, echo = FALSE}
plots[[6]]
```

#### 50 to 54
```{r, echo = FALSE}
plots[[7]]
```

#### 55 to 59
```{r, echo = FALSE}
plots[[8]]
```

#### 60 to 64
```{r, echo = FALSE}
plots[[9]]
```

#### 65 to 69
```{r, echo = FALSE}
plots[[10]]
```

#### 70 to 74
```{r, echo = FALSE}
plots[[11]]
```

#### 75 to 79
```{r, echo = FALSE}
plots[[12]]
```

#### 80 to 84
```{r, echo = FALSE}
plots[[13]]
```

#### 85 to 89
```{r, echo = FALSE}
plots[[14]]
```

#### 90 and over
```{r, echo = FALSE}
plots[[15]]
```

### **Males** Select age group {.tabset .tabset-dropdown}

```{r}

temp_inc <- data_inc_2001to2020_C0toC97_allandbyagesex %>% 
        group_by(Gender, Age_at_Diagnosis) %>%
        arrange(Year, .by_group = TRUE) %>%
        mutate(pct_change = (Rate/lag(Rate) - 1) * 100) %>%
        filter(Age_at_Diagnosis != "All ages") %>%
        filter(grepl(c("Male"), Gender))


names_plotageinc_list <- levels(factor(temp_inc$Age_at_Diagnosis))
        
l_temp_inc <- temp_inc %>% group_split(ICD10_descrip)

plots <- map(l_temp_inc, ~ ggplotly(ggbarplot(.x, y = "pct_change", x = "Year") +
  theme_bw() +
  theme(strip.text = element_text(size = 12)) +
  xlab("Year") +
  ylab("Annual percentage change") +
  theme(strip.background =element_rect(fill="white")) +
  theme(legend.position ="bottom") +
          facet_wrap(vars(Age_at_Diagnosis), ncol = 3),
  height = 300, width=800))

names(plots) = names_plotageinc_list


```


#### 20 to 24
```{r, echo = FALSE}
plots[[1]]
```

#### 25 to 29
```{r, echo = FALSE}
plots[[2]]
```

#### 30 to 34
```{r, echo = FALSE}
plots[[3]]
```

#### 35 to 39
```{r, echo = FALSE}
plots[[4]]
```

#### 40 to 44
```{r, echo = FALSE}
plots[[5]]
```

#### 45 to 49
```{r, echo = FALSE}
plots[[6]]
```

#### 50 to 54
```{r, echo = FALSE}
plots[[7]]
```

#### 55 to 59
```{r, echo = FALSE}
plots[[8]]
```

#### 60 to 64
```{r, echo = FALSE}
plots[[9]]
```

#### 65 to 69
```{r, echo = FALSE}
plots[[10]]
```

#### 70 to 74
```{r, echo = FALSE}
plots[[11]]
```

#### 75 to 79
```{r, echo = FALSE}
plots[[12]]
```

#### 80 to 84
```{r, echo = FALSE}
plots[[13]]
```

#### 85 to 89
```{r, echo = FALSE}
plots[[14]]
```

#### 90 and over
```{r, echo = FALSE}
plots[[15]]
```

<br>


###  Trends in **incidence** from 2001 to 2020 by select cancer sites

### Select Site (ICD 10) {.tabset .tabset-dropdown}

```{r}

temp_inc <- data_inc_2001to2020_bysite_allandbysex %>% 
        filter(Type_of_rate == "Age-standardised") %>%
        select(Year, Gender,Age_at_Diagnosis, ICD10_code, Site_description, Rate) %>%
        pivot_wider(names_from = Gender, values_from = c(Rate)) %>%
        filter(grepl(c("C"), ICD10_code)) %>% 
        unite(ICD10_descrip, ICD10_code , Site_description, sep = " ", remove = TRUE)

names_plot_list <- levels(factor(temp_inc$ICD10_descrip))

l_temp_inc <- temp_inc %>% group_split(ICD10_descrip)

plots <- map(l_temp_inc, ~ ggplotly(ggplot(.x, aes(x=Year)) + 
                     geom_line(aes(y = Persons), color = "darkred") + 
                     geom_line(aes(y = Male), color = "blue") + 
                     geom_line(aes(y = Female), color = "green") + 
                     theme_bw() +
                     theme(strip.text = element_text(size = 12)) +
                     xlab("Year") +
                     ylab("ASR per 100,000") +
                     theme(strip.background =element_rect(fill="white")), height = 800, width=800))

names(plots) = names_plot_list
        
```

#### C00-C14 Malignant neoplasm of lip, oral cavity and pharynx
```{r, echo = FALSE}
plots[[1]]
```

#### C15 Malignant neoplasm of oesophagus
```{r, echo = FALSE}
plots[[17]]
```

#### C16 Malignant neoplasm of stomach
```{r, echo = FALSE}
plots[[18]]
```

#### C18 Malignant neoplasm of colon
```{r, echo = FALSE}
plots[[21]]
```

#### C19 Malignant neoplasm of rectosigmoid junction
```{r, echo = FALSE}
plots[[22]]
```

#### C20  Malignant neoplasm of rectum
```{r, echo = FALSE}
plots[[23]]
```

#### C22 Malignant neoplasm of Malignant neoplasm of liver and intrahepatic bile ducts
```{r, echo = FALSE}
plots[[25]]
```

#### C25 Malignant neoplasm of pancreas
```{r, echo = FALSE}
plots[[28]]
```

#### C33-C34 Malignant neoplasm of trachea, bronchus and lung
```{r, echo = FALSE}
plots[[33]]
```

#### C43 Malignant melanoma of skin
```{r, echo = FALSE}
plots[[41]]
```

#### C44 Other malignant neoplasms of skin
```{r, echo = FALSE}
plots[[42]]
```

#### C50 Malignant neoplasm of breast
```{r, echo = FALSE}
plots[[48]]
```

#### C54-C55 Malignant neoplasm of corpus uteri and uterus, part unspecified"
```{r, echo = FALSE}
plots[[52]]
```

#### C56-C57 Malignant neoplasm of ovary and other unspecified female genital organs"
```{r, echo = FALSE}
plots[[55]]
```

#### C61 Malignant neoplasm of prostate
```{r, echo = FALSE}
plots[[60]]
```

#### C62 Malignant neoplasm of testis
```{r, echo = FALSE}
plots[[61]]
```

#### C64 Malignant neoplasm of kidney, except renal pelvis
```{r, echo = FALSE}
plots[[63]]
```

#### C67 Malignant neoplasm of bladder
```{r, echo = FALSE}
plots[[66]]
```

#### C71 Malignant neoplasm of brain
```{r, echo = FALSE}
plots[[70]]
```

#### C80 Malignant neoplasm, without specification of site
```{r, echo = FALSE}
plots[[79]]
```

#### C81  Hodgkin lymphoma
```{r, echo = FALSE}
plots[[80]]
```

#### C82-C86 Non-Hodgkin lymphoma
```{r, echo = FALSE}
plots[[81]]
```

#### C90 Multiple myeloma and malignant plasma cell neoplasms
```{r, echo = FALSE}
plots[[88]]
```

#### C91-C95 Leukaemia
```{r, echo = FALSE}
plots[[89]]
```

<br>

### Percentage Change in **incidence** from 2001 to 2020 by select cancer sites
```{r}

kable(data_inc_2001to2020_bysite_allandbysex %>% 
        filter(Type_of_rate == "Age-standardised") %>%
        filter(Gender == "Persons") %>%
        select(Year, Gender, Age_at_Diagnosis, ICD10_code, Site_description, Rate) %>%
        pivot_wider(names_from = Year, values_from = c(Rate)) %>%
        filter(grepl(c("C"), ICD10_code)) %>% 
        unite(ICD10_descrip, ICD10_code , Site_description, sep = " ", remove = TRUE) %>%
        mutate(Percentage_change_2014_to_2019 = round((`2019` - `2014`)/`2014` * 100)) %>%
        mutate(Percentage_change_2009_to_2019 = round((`2019` - `2009`)/`2009` * 100)) %>%
        mutate(Percentage_change_2001_to_2019 = round((`2019` - `2001`)/`2001` * 100)) %>%
        arrange(desc(Percentage_change_2014_to_2019)) %>%
        filter(`2019` > 1) %>%
        filter(!grepl(c("C79|C88|C93|C85|C66|C69|C34|C33|C02|C84|C83|C91|C92|C78"),ICD10_descrip )) %>%
        select(ICD10_descrip, `2001`,`2009`,`2014`,`2019`, Percentage_change_2001_to_2019, Percentage_change_2009_to_2019, Percentage_change_2014_to_2019) %>%
        rename( ICD10 = ICD10_descrip, `01-19` = Percentage_change_2001_to_2019, `09-19` = Percentage_change_2009_to_2019 ,
                `14-19` = Percentage_change_2014_to_2019)) %>%
       kableExtra:::add_header_above(c(" " = 1, "ASR" = 4, "% change" = 3)) %>%
       kable_classic("hover", full_width = T) 

```

<br>

##  Mortality

### Age-standardised **mortality** rates from 2001 to 2020 for all cancer sites (C0 to C97) combined, stratified by sex

```{r}

temp_mort <- data_mort_2001to2020_C0toC97_allageandbysex %>%
        filter(Type_of_rate == "Age-standardised") %>%
        pivot_wider(names_from = Gender, values_from = c(Count, Rate, LCI, UCI))

ggplotly(ggplot(temp_mort, aes(x=Year)) + 
  geom_line(aes(y = Rate_Persons), color = "darkred") + 
  geom_line(aes(y = LCI_Persons), color="red", linetype="twodash") +
  geom_line(aes(y = UCI_Persons), color="red", linetype="twodash") +
  geom_line(aes(y = Rate_Male), color = "blue") + 
  geom_line(aes(y = LCI_Male), color="steelblue", linetype="twodash") +
  geom_line(aes(y = UCI_Male), color="steelblue", linetype="twodash") +
  geom_line(aes(y = Rate_Female), color = "green") + 
  geom_line(aes(y = LCI_Female), color="darkgreen", linetype="twodash") +
  geom_line(aes(y = UCI_Female), color="darkgreen", linetype="twodash") +
  theme_bw() +
  theme(strip.text = element_text(size = 12)) +
  xlab("Year") +
  ylab("ASR per 100,000") +
  theme(strip.background =element_rect(fill="white")),
  height = 800, width=800) 

```

<br>

### Annual percentage change in **mortality** from 2001 to 2020 for all cancer sites (C0 to C97) combined, **Males**

```{r}

temp_mort <- data_mort_2001to2020_C0toC97_allandbyagesex %>% 
        group_by(Gender, Age_at_Diagnosis) %>%
        arrange(Year, .by_group = TRUE) %>%
        mutate(pct_change = (Rate/lag(Rate) - 1) * 100) %>%
        filter(Age_at_Diagnosis != "All ages")
        
ggplotly(ggbarplot(temp_mort %>% 
                        filter(grepl(c("Male"), Gender)), 
                y = "pct_change", x = "Year") +
  theme_bw() +
  theme(strip.text = element_text(size = 12)) +
  xlab("Year") +
  ylab("Annual percentage change") +
  theme(strip.background =element_rect(fill="white")) +
  theme(legend.position ="bottom") +
          facet_wrap(vars(Age_at_Diagnosis), ncol = 3),
  height = 2000, width=800)


```

<br>

### Annual percentage change in **mortality** from 2001 to 2020 for all cancer sites (C0 to C97) combined, **Females**

```{r}

temp_mort <- data_mort_2001to2020_C0toC97_allandbyagesex %>% 
        group_by(Gender, Age_at_Diagnosis) %>%
        arrange(Year, .by_group = TRUE) %>%
        mutate(pct_change = (Rate/lag(Rate) - 1) * 100) %>%
        filter(Age_at_Diagnosis != "All ages")
        
ggplotly(ggbarplot(temp_mort %>% 
                        filter(grepl(c("Female"), Gender)), 
                y = "pct_change", x = "Year") +
  theme_bw() +
  theme(strip.text = element_text(size = 12)) +
  xlab("Year") +
  ylab("Annual percentage change") +
  theme(strip.background =element_rect(fill="white")) +
  theme(legend.position ="bottom") +
          facet_wrap(vars(Age_at_Diagnosis), ncol = 3),
  height = 2000, width=800)


```

<br>


###  Trends in **mortality** from 2001 to 2020 by select cancer sites

### Select Site (ICD 10) {.tabset .tabset-dropdown}

```{r}

temp_mort <- data_mort_2001to2020_bysite_allandbysex %>% 
        filter(Type_of_rate == "Age-standardised") %>%
        select(Year, Gender,Age_at_Diagnosis, ICD10_code, Site_description, Rate) %>%
        pivot_wider(names_from = Gender, values_from = c(Rate)) %>%
        filter(grepl(c("C"), ICD10_code)) %>% 
        unite(ICD10_descrip, ICD10_code , Site_description, sep = " ", remove = TRUE)

names_plot_list <- levels(factor(temp_mort$ICD10_descrip))

l_temp_mort <- temp_mort %>% group_split(ICD10_descrip)

plots <- map(l_temp_mort, ~ ggplotly(ggplot(.x, aes(x=Year)) + 
                     geom_line(aes(y = Persons), color = "darkred") + 
                     geom_line(aes(y = Male), color = "blue") + 
                     geom_line(aes(y = Female), color = "green") + 
                     theme_bw() +
                     theme(strip.text = element_text(size = 12)) +
                     xlab("Year") +
                     ylab("ASR per 100,000") +
                     theme(strip.background =element_rect(fill="white"))))

names(plots) = names_plot_list
        
```

#### C15 Malignant neoplasm of oesophagus
```{r, echo = FALSE}
plots[[16]]
```

#### C16 Malignant neoplasm of stomach
```{r, echo = FALSE}
plots[[17]]
```

#### C18 Malignant neoplasm of colon
```{r, echo = FALSE}
plots[[20]]
```

#### C19 Malignant neoplasm of rectosigmoid junction
```{r, echo = FALSE}
plots[[21]]
```

#### C20  Malignant neoplasm of rectum
```{r, echo = FALSE}
plots[[22]]
```

#### C22 Malignant neoplasm of Malignant neoplasm of liver and intrahepatic bile ducts
```{r, echo = FALSE}
plots[[24]]
```

#### C25 Malignant neoplasm of pancreas
```{r, echo = FALSE}
plots[[27]]
```

#### C33-C34 Malignant neoplasm of trachea, bronchus and lung
```{r, echo = FALSE}
plots[[32]]
```

#### C43 Malignant melanoma of skin
```{r, echo = FALSE}
plots[[40]]
```

#### C44 Other malignant neoplasms of skin
```{r, echo = FALSE}
plots[[41]]
```

#### C50 Malignant neoplasm of breast
```{r, echo = FALSE}
plots[[47]]
```

#### C54-C55 Malignant neoplasm of corpus uteri and uterus, part unspecified"
```{r, echo = FALSE}
plots[[51]]
```

#### C56-C57 Malignant neoplasm of ovary and other unspecified female genital organs"
```{r, echo = FALSE}
plots[[54]]
```

#### C61 Malignant neoplasm of prostate
```{r, echo = FALSE}
plots[[59]]
```

#### C62 Malignant neoplasm of testis
```{r, echo = FALSE}
plots[[60]]
```

#### C64 Malignant neoplasm of kidney, except renal pelvis
```{r, echo = FALSE}
plots[[62]]
```

#### C67 Malignant neoplasm of bladder
```{r, echo = FALSE}
plots[[65]]
```

#### C71 Malignant neoplasm of brain
```{r, echo = FALSE}
plots[[69]]
```

#### C80 Malignant neoplasm, without specification of site
```{r, echo = FALSE}
plots[[78]]
```

#### C81  Hodgkin lymphoma
```{r, echo = FALSE}
plots[[79]]
```

#### C82-C86 Non-Hodgkin lymphoma
```{r, echo = FALSE}
plots[[80]]
```

#### C90 Multiple myeloma and malignant plasma cell neoplasms
```{r, echo = FALSE}
plots[[87]]
```

#### C91-C95 Leukaemia
```{r, echo = FALSE}
plots[[88]]
```

<br>

### Percentage Change in **mortality** from 2001 to 2020 by select cancer sites
```{r}

kable(data_mort_2001to2020_bysite_allandbysex %>% 
        filter(Type_of_rate == "Age-standardised") %>%
        filter(Gender == "Persons") %>%
        select(Year, Gender, Age_at_Diagnosis, ICD10_code, Site_description, Rate) %>%
        pivot_wider(names_from = Year, values_from = c(Rate)) %>%
        filter(grepl(c("C"), ICD10_code)) %>% 
        unite(ICD10_descrip, ICD10_code , Site_description, sep = " ", remove = TRUE) %>%
        mutate(Percentage_change_2014_to_2019 = round((`2019` - `2014`)/`2014` * 100)) %>%
        mutate(Percentage_change_2009_to_2019 = round((`2019` - `2009`)/`2009` * 100)) %>%
        mutate(Percentage_change_2001_to_2019 = round((`2019` - `2001`)/`2001` * 100)) %>%
        arrange(desc(Percentage_change_2014_to_2019)) %>%
        filter(`2019` > 1) %>%
        filter(!grepl(c("C79|C88|C93|C85|C66|C69|C34|C33|C02|C84|C83|C91|C92|C78"),ICD10_descrip )) %>%
        select(ICD10_descrip, `2001`,`2009`,`2014`,`2019`, Percentage_change_2001_to_2019, Percentage_change_2009_to_2019, Percentage_change_2014_to_2019) %>%
        rename( ICD10 = ICD10_descrip, `01-19` = Percentage_change_2001_to_2019, `09-19` = Percentage_change_2009_to_2019 ,
                `14-19` = Percentage_change_2014_to_2019)) %>%
       kableExtra:::add_header_above(c(" " = 1, "ASR" = 4, "% change" = 3)) %>%
       kable_classic("hover", full_width = T) 
```

<br>

## Survival

The following note is attached to the data from CancerData

*An incident case of cancer is a new case of cancer, counted once when the cancer is diagnosed.*

*Incident cases of cancer are counted for each separate primary tumour. One person may be diagnosed with more than one tumour, and would then appear twice in the incidence statistics. Recurrences of a previous cancer are not counted as new incident cases.*

*Cancer mortality estimates show the numbers of people who died as a result of cancer. It does not include people who were diagnosed with cancer but died from an unrelated cause of death.*

*Standardised rates for England are standardised according to 2013 European Standard Population (ESP). Standardised rates for sub-Integrated Care Board locations (sub-ICBLs) are standardised according to an approximate 2013 European Standard Population. This approximation is created by grouping the five year age bands in the ESP into the 5 age bands published on this tool.*

*Data presented are taken from the National Cancer Registration Service Cancer Analysis System, snapshot CAS2210.*






